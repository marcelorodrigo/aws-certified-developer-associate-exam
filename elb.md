# Elastic Load Balancing

- ELB are servers that forward traffic from internet to multiple EC2 instances
- Provides SSL termination
- High Availability through multiple availability zones (AZ)
- Separates public traffic from internal traffic
- Health Checks
  - ELB performs regular helth checks on allocated instances
  - If one instance does not provide 200 (OK), is marked as unhealthy

## Elastic Load Balancer Types

- [Classic Load Balancer](clb.md)
  - v1 old generation - from 2009
  - HTTP, HTTPS, TCP
- [Application Load Balancer](alb.md)
  - v2 current generation - from 2016
  - HTTP, HTTPS, WebSocket
- [Network Load Balancer](nlb.md)
  - v2 current generation - from 2017
  - TCP, TLS (secure TCP) & UDP

## Internal vs External ELB
- It is possible to setup an interna or external ELB
- You can build an internal ELB, that will not be available to the internet.

## Session Stickness
- Is possible to implement session stickness on [Application LB](alb.md) and [Classic LB](clb.md)
- Uses a cookie to store which server has the user session
### Application Based Cookies
- Your application can be responsible for generating the cookie (or you can ask LB to generate for you)
- It can include custion attributes
- Cookie name can be specified for each target group individually
### Duration Based Cookies
- Cookie is generated by LB
- Based on duration/expiration

## Cross Zone Load Balancing
ELB ensures that requests are distributed equally to your back-end instances regardless of the Availability Zone in which they are located.
- ALB: enabled by default, cannot be disabled, you don't pay for AZ traffic
- NLB: disabled by default, can be enabled, you pay for AZ traffic.
- CLB: enabled by default on Console (disabled via API), can be enabled, you don't pay for AZ traffic.

## Connection Draining
Time to complete pending requests while the instance is de-registered or unhealthy.
- Between 1 to 3600 seconds (default is 300)
- Can be disabled (set to 0)

They have different names for same functionality:
- CLB: Connection Training
- Target Group: Deregistration Deylay (for ALB & NLB)


## Good things to know
- It's recommended to create a Security Group that allows your EC2 machines to receive traffic only from the ELB
- LB's can scale, but not instantly (you should contact AWS for a warm-up)
- Troubleshooting
  - 4xx errors are client induced errors
  - 5xx errors are application induced errors
  - Load Balancer Errors 503 means at capacity or no registered target (overloading)
  - If the LB cannot connect to your app, check our ASG
- Monitoring
  - ELB access logs will log all requests
  - CloudWatch Metrics gives you a broad view on statistics 
